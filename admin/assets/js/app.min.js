var Formwork={baseUri:"",config:{},init:function(){this.baseUri=$("meta[name=base-uri]").getAttribute("content"),Formwork.Modals.init(),Formwork.Forms.init(),Formwork.Dropdowns.init(),Formwork.Tooltips.init(),Formwork.Dashboard.init(),Formwork.Pages.init(),Formwork.Updates.init(),$(".toggle-navigation").addEventListener("click",function(){$(".sidebar").classList.toggle("show")}),$$("[data-chart-data]").forEach(function(e){var t=JSON.parse(e.getAttribute("data-chart-data"));Formwork.Chart(e,t)}),$$("meta[name=notification]").forEach(function(e){new Formwork.Notification(e.getAttribute("content"),e.getAttribute("data-type"),e.getAttribute("data-interval")).show(),e.parentNode.removeChild(e)}),$("[data-command=save]")&&document.addEventListener("keydown",function(e){e.altKey||!e.ctrlKey&&!e.metaKey||83===e.which&&($("[data-command=save]").click(),e.preventDefault())})},initGlobals:function(e){e.$=function(e,t){return void 0===t&&(t=document),t.querySelector(e)},e.$$=function(e,t){return void 0===t&&(t=document),t.querySelectorAll(e)},"forEach"in e.NodeList.prototype||(e.NodeList.prototype.forEach=e.Array.prototype.forEach),"matches"in e.Element.prototype||(e.Element.prototype.matches=e.Element.prototype.msMatchesSelector||e.Element.prototype.webkitMatchesSelector),"closest"in e.Element.prototype||(e.Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}};document.addEventListener("DOMContentLoaded",function(){Formwork.init()}),Formwork.initGlobals(window),Formwork.ArrayInput=function(e){var t=e.classList.contains("array-input-associative"),n=e.getAttribute("data-name");function a(){var e=this.closest(".array-input-row");0<$$(".array-input-row",e.parentNode).length?e.parentNode.removeChild(e):($(".array-input-key",e).value="",$(".array-input-value",e).value="",Formwork.Utils.triggerEvent($(".array-input-key",e),"keyup"))}$(".array-input-add",e).addEventListener("click",function e(){var t=this.closest(".array-input-row");var n=t.cloneNode(!0);$(".array-input-key",n).value="";$(".array-input-value",n).value="";$(".array-input-add",n).addEventListener("click",e);$(".array-input-remove",n).addEventListener("click",a);t.nextSibling?t.parentNode.insertBefore(n,t.nextSibling):t.parentNode.appendChild(n)}),$(".array-input-remove",e).addEventListener("click",a),t&&($(".array-input-key",e).addEventListener("keyup",function(){$(".array-input-value",this.parentNode).setAttribute("name",n+"["+this.value+"]")}),$(".array-input-value",e).addEventListener("keyup",function(){this.setAttribute("name",n+"["+$(".array-input-key",this.parentNode).value+"]")})),Sortable.create(e,{handle:".sort-handle",forceFallback:!0})},Formwork.Chart=function(e,t){new Chartist.Line(e,t,{showArea:!0,fullWidth:!0,scaleMinSpace:20,divisor:5,chartPadding:20,lineSmooth:!1,low:0,axisX:{showGrid:!1,labelOffset:{x:0,y:10}},axisY:{onlyInteger:!0,offset:15,labelOffset:{x:0,y:5}}}).container.addEventListener("mouseover",function(e){var t,n;"ct-point"===e.target.getAttribute("class")&&(t={x:0,y:-8},-1!==navigator.userAgent.indexOf("Firefox")&&(n=parseFloat(getComputedStyle(e.target)["stroke-width"]),t.x+=n/2,t.y+=n/2),new Formwork.Tooltip(e.target.getAttribute("ct:value"),{referenceElement:e.target,offset:t}).show())})},Formwork.Dashboard={init:function(){var e=$("[data-command=clear-cache]"),t=$("[data-command=make-backup]");e&&e.addEventListener("click",function(){Formwork.Request({method:"POST",url:Formwork.baseUri+"cache/clear/",data:{"csrf-token":$("meta[name=csrf-token]").getAttribute("content")}},function(e){new Formwork.Notification(e.message,e.status,5e3).show()})}),t&&t.addEventListener("click",function(){var t=this;t.setAttribute("disabled",""),Formwork.Request({method:"POST",url:Formwork.baseUri+"backup/make/",data:{"csrf-token":$("meta[name=csrf-token]").getAttribute("content")}},function(e){new Formwork.Notification(e.message,e.status,5e3).show(),setTimeout(function(){"success"===e.status&&Formwork.Utils.triggerDownload(e.data.uri,$("meta[name=csrf-token]").getAttribute("content")),t.removeAttribute("disabled")},1e3)})})}},Formwork.DatePicker=function(c,u){var m,f,p,e=new Date;function a(e){var t=new Date(m.year,m.month,m.day);n(m.year,m.month,m.day),e.value=f.formatDateTime(t),e.setAttribute("data-date",t)}function h(){return document.activeElement.classList.contains("date-input")?document.activeElement:null}function n(e,t,n){var a,o,i=1,r=new Date(e,t,1).getDay(),s=f.daysInMonth(t,e),d=u.monthLabels[t],l=f.mod(r-u.weekStarts,7),c="";for(c+='<tr><th class="calendar-header" colspan="7">',c+=d+"&nbsp;"+e,c+="</th></tr>",c+="<tr>",a=0;a<7;a++)c+='<td class="calendar-header-day">',c+=u.dayLabels[f.mod(a+u.weekStarts,7)],c+="</td>";for(c+="</tr><tr>",a=0;a<6;a++){for(o=0;o<7;o++)i<=s&&(0<a||l<=o)?(c+=i===n?'<td class="calendar-day selected">':'<td class="calendar-day">',c+=i++):1===i?(c+='<td class="calendar-prev-month-day">',c+=f.daysInMonth(f.mod(t-1,12),e)-l+o+1):(c+='<td class="calendar-next-month-day">',c+=i++-s),c+="</td>";c+="</tr><tr>"}c+="</tr>",$(".calendar-table",p).innerHTML=c,$$(".calendar-day",p).forEach(function(e){e.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),e.addEventListener("click",function(){var e=h(),t=new Date(m.year,m.month,parseInt(this.textContent));e.setAttribute("data-date",t),e.value=f.formatDateTime(t),e.blur()})})}function t(){var e,t,n,a,o,i,r,s,d,l;(c=h())&&"block"===p.style.display&&(t=(e=c.getBoundingClientRect()).top+window.pageYOffset,n=e.left+window.pageXOffset,p.style.top=t+c.offsetHeight+"px",p.style.left=n+c.offsetLeft+"px",o=(a=p.getBoundingClientRect()).top+window.pageYOffset,i=a.left+window.pageXOffset,r=Formwork.Utils.outerWidth(p),s=Formwork.Utils.outerHeight(p),d=document.documentElement.clientWidth,l=document.documentElement.clientHeight,d<i+r&&(p.style.left=d-r+"px"),(o<window.pageYOffset||window.pageYOffset<o+s-l)&&window.scrollTo(window.pageXOffset,o+s-l))}u=Formwork.Utils.extendObject({},{dayLabels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthLabels:["January","February","March","April","May","June","July","August","September","October","November","December"],weekStarts:0,todayLabel:"Today",format:"YYYY-MM-DD"},u),m={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),setDate:function(e){this.year=e.getFullYear(),this.month=e.getMonth(),this.day=e.getDate()},lastDay:function(){this.day=f.daysInMonth(this.month,this.year)},prevYear:function(){this.year--},nextYear:function(){this.year++},prevMonth:function(){this.month=f.mod(this.month-1,12),11===this.month&&this.prevYear(),this.day>f.daysInMonth(this.month,this.year)&&this.lastDay()},nextMonth:function(){this.month=f.mod(this.month+1,12),0===this.month&&this.nextYear(),this.day>f.daysInMonth(this.month,this.year)&&this.lastDay()},prevWeek:function(){this.day-=7,this.day<1&&(this.prevMonth(),this.day+=f.daysInMonth(this.month,this.year))},nextWeek:function(){this.day+=7,this.day>f.daysInMonth(this.month,this.year)&&(this.day-=f.daysInMonth(this.month,this.year),this.nextMonth())},prevDay:function(){this.day--,this.day<1&&(this.prevMonth(),this.lastDay())},nextDay:function(){this.day++,this.day>f.daysInMonth(this.month,this.year)&&(this.nextMonth(),this.day=1)}},f={_daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],mod:function(e,t){return(e%t+t)%t},pad:function(e){return 1===e.toString().length?"0"+e:e},isValidDate:function(e){return e&&!isNaN(Date.parse(e))},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},daysInMonth:function(e,t){return 1===e&&this.isLeapYear(t)?29:this._daysInMonth[e]},formatDateTime:function(e){var t=u.format,n=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),i=e.getHours(),r=e.getMinutes(),s=e.getSeconds(),d=i<12;return-1<t.indexOf("a")&&(i=0<f.mod(i,12)?f.mod(i,12):12),t.replace("YYYY",n).replace("YY",n.toString().substr(-2)).replace("MM",f.pad(a)).replace("DD",f.pad(o)).replace("hh",f.pad(i)).replace("mm",f.pad(r)).replace("ss",f.pad(s)).replace("a",d?"AM":"PM")}},p=$(".calendar")?$(".calendar"):((p=document.createElement("div")).className="calendar",p.innerHTML='<div class="calendar-buttons"><button type="button" class="prevMonth"><i class="i-chevron-left"></i></button><button class="currentMonth">'+u.todayLabel+'</button><button type="button" class="nextMonth"><i class="i-chevron-right"></i></button></div><div class="calendar-separator"></div><table class="calendar-table"></table>',document.body.appendChild(p),$(".currentMonth",p).addEventListener("mousedown",function(e){var t=h(),n=new Date;m.setDate(n),a(t),t.blur(),e.preventDefault()}),Formwork.Utils.longClick($(".prevMonth",p),function(e){m.prevMonth(),n(m.year,m.month),e.preventDefault()},750,500),Formwork.Utils.longClick($(".nextMonth",p),function(e){m.nextMonth(),n(m.year,m.month),e.preventDefault()},750,500),window.addEventListener("mousedown",function(e){"none"!==p.style.display&&e.target.closest(".calendar")&&e.preventDefault()}),window.addEventListener("resize",Formwork.Utils.throttle(t,100)),p),function(){var e=c.value;c.readOnly=!0,c.size=u.format.length,f.isValidDate(e)&&(e=new Date(e),c.setAttribute("data-date",e),c.value=f.formatDateTime(e));c.addEventListener("change",function(){""===this.value?this.setAttribute("data-date",""):this.value=f.formatDateTime(this.getAttribute("data-date"))}),c.addEventListener("keydown",function(e){var t=this.getAttribute("data-date");switch(m.setDate(f.isValidDate(t)?new Date(t):new Date),e.which){case 13:$(".calendar-day.selected",p).click(),p.style.display="none";break;case 8:this.value="",this.blur(),p.style.display="none";break;case 27:this.blur(),p.style.display="none";break;case 37:e.ctrlKey||e.metaKey?e.shiftKey?m.prevYear():m.prevMonth():m.prevDay(),a(this);break;case 38:m.prevWeek(),a(this);break;case 39:e.ctrlKey||e.metaKey?e.shiftKey?m.nextYear():m.nextMonth():m.nextDay(),a(this);break;case 40:m.nextWeek(),a(this);break;case 48:(e.ctrlKey||e.metaKey)&&m.setDate(new Date),a(this);break;default:return}e.stopPropagation(),e.preventDefault()}),c.addEventListener("focus",function(){var e=f.isValidDate(this.getAttribute("data-date"))?new Date(this.getAttribute("data-date")):new Date;m.setDate(e),n(m.year,m.month,m.day),p.style.display="block",t()}),c.addEventListener("blur",function(){p.style.display="none"})}()},Formwork.Dropdowns={init:function(){$(".dropdown")&&document.addEventListener("click",function(e){var t,n,a=e.target.closest(".dropdown-button");a&&(t=document.getElementById(a.getAttribute("data-dropdown")),n="none"!==getComputedStyle(t).display,e.preventDefault()),$$(".dropdown-menu").forEach(function(e){e.style.display=""}),t&&!n&&(t.style.display="block")})}},Formwork.Editor=function(e){var r=CodeMirror.fromTextArea(e,{mode:"markdown",theme:"formwork",indentUnit:4,lineWrapping:!0,addModeClass:!0,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}}),t=$(".editor-toolbar[data-for="+e.id+"]");function n(){return/\n+===\n+/.test(r.getValue())}function a(){n()?$("[data-command=summary]",t).setAttribute("disabled",""):$("[data-command=summary]",t).removeAttribute("disabled")}function o(){var e=r.getLine(r.getCursor().line);return 0===e.length?void 0:e.slice(-1)}function i(){switch(o()){case void 0:return"";case"\n":return"\n";default:return"\n\n"}}function s(e,t,n){var a,o,i;void 0===t&&(t=e),a=!0===n?"":r.getSelection(),o=r.getCursor(),i=e.split("\n").length-1,r.replaceSelection(e+a+t),r.setCursor(o.line+i,o.ch+e.length-i),r.focus()}$("[data-command=bold]",t).addEventListener("click",function(){s("**")}),$("[data-command=italic]",t).addEventListener("click",function(){s("_")}),$("[data-command=ul]",t).addEventListener("click",function(){s(i()+"- ","")}),$("[data-command=ol]",t).addEventListener("click",function(){var e,t,n=/^\d+\./.exec((e=r.getValue(),-1!==(t=e.lastIndexOf("\n"))?e.substring(t+1):e));s(n?"\n"+(parseInt(n)+1)+". ":i()+"1. ","")}),$("[data-command=quote]",t).addEventListener("click",function(){s(i()+"> ","")}),$("[data-command=link]",t).addEventListener("click",function(){var e=r.getSelection();/^(https?:\/\/|mailto:)/i.test(e)?s("[","]("+e+")",!0):""!==e?s("["+e+"](http://",")",!0):s("[","](http://)")}),$("[data-command=image]",t).addEventListener("click",function(){Formwork.Modals.show("imagesModal",null,function(e){var t=$(".image-picker-thumbnail.selected",e);t&&t.classList.remove("selected"),$(".image-picker-confirm",e).addEventListener("click",function e(){var t=$(".image-picker-thumbnail.selected",$("#imagesModal")).getAttribute("data-filename");void 0!==t?s(i()+"![","]("+t+")"):s(i()+"![](",")"),this.removeEventListener("click",e)})})}),$("[data-command=summary]",t).addEventListener("click",function(){var e;n()||(s((void 0===(e=o())||"\n"===e?"":"\n")+"\n===\n\n",""),this.setAttribute("disabled",""))}),$("[data-command=undo]",t).addEventListener("click",function(){r.undo(),r.focus()}),$("[data-command=redo]",t).addEventListener("click",function(){r.redo(),r.focus()}),a(),r.on("changes",Formwork.Utils.debounce(function(){e.value=r.getValue(),a(),r.historySize().undo<1?$("[data-command=undo]").setAttribute("disabled",""):$("[data-command=undo]").removeAttribute("disabled"),r.historySize().redo<1?$("[data-command=redo]").setAttribute("disabled",""):$("[data-command=redo]").removeAttribute("disabled")},500)),document.addEventListener("keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey))switch(e.which){case 66:$("[data-command=bold]",t).click(),e.preventDefault();break;case 73:$("[data-command=italic]",t).click(),e.preventDefault();break;case 75:$("[data-command=link]",t).click(),e.preventDefault()}})},Formwork.FileInput=function(e){var t=$('label[for="'+e.id+'"]');function n(){var e=$('label[for="'+this.id+'"] span');0<this.files.length?e.innerHTML=this.files[0].name:e.innerHTML=this.getAttribute("data-label")}function a(e){e.preventDefault()}function o(e){this.classList.add("drag"),e.preventDefault()}e.setAttribute("data-label",$('label[for="'+e.id+'"] span').innerHTML),e.addEventListener("change",n),e.addEventListener("input",n),t.addEventListener("drag",a),t.addEventListener("dragstart",a),t.addEventListener("dragend",a),t.addEventListener("dragover",o),t.addEventListener("dragenter",o),t.addEventListener("dragleave",function(e){this.classList.remove("drag"),e.preventDefault()}),t.addEventListener("drop",function(e){var t=document.getElementById(this.getAttribute("for"));t.files=e.dataTransfer.files,Formwork.Utils.triggerEvent(t,"change"),e.preventDefault()})},Formwork.Form=function(a){var o=Formwork.Utils.serializeForm(a);function e(e){n()&&(e.preventDefault(),e.returnValue="")}function n(e){var t,n;if(t=$$("input[file]",a),void 0===e&&(e=!0),!0===e&&0<t.length)for(n=0;n<t.length;n++)if(0<t[n].files.length)return 1;return Formwork.Utils.serializeForm(a)!==o}a.addEventListener("submit",function(){window.removeEventListener("beforeunload",e)}),window.addEventListener("beforeunload",e),$$("input[type=file][data-auto-upload]",a).forEach(function(e){e.addEventListener("change",function(){n(!1)||a.submit()})}),$("#changesModal [data-command=continue]").addEventListener("click",function(){window.removeEventListener("beforeunload",e),window.location.href=this.getAttribute("data-href")}),$$('a[href]:not([href^="#"]):not([target="_blank"])').forEach(function(t){t.addEventListener("click",function(e){n()&&(e.preventDefault(),Formwork.Modals.show("changesModal",null,function(e){$("[data-command=continue]",e).setAttribute("data-href",t.href)}))})})},Formwork.Forms={init:function(){$$("[data-form]").forEach(function(e){Formwork.Form(e)}),$$("input[data-enable]").forEach(function(e){e.addEventListener("change",function(){var e,t,n=this.getAttribute("data-enable").split(",");for(e=0;e<n.length;e++)t=$('input[name="'+n[e]+'"]'),this.checked?t.removeAttribute("disabled"):t.setAttribute("disabled","")})}),$$(".input-reset").forEach(function(e){e.addEventListener("click",function(){var e=document.getElementById(this.getAttribute("data-reset"));e.value="",Formwork.Utils.triggerEvent(e,"change")})}),$$(".date-input").forEach(function(e){Formwork.DatePicker(e,Formwork.config.DatePicker)}),$$(".image-input").forEach(function(n){n.addEventListener("click",function(){Formwork.Modals.show("imagesModal",null,function(e){var t=$(".image-picker-thumbnail.selected",e);t&&t.classList.remove("selected"),this.value&&$('.image-picker-thumbnail[data-filename="'+this.value+'"]',e).classList.add("selected"),$(".image-picker-confirm",e).setAttribute("data-target",n.id)})})}),$$(".image-picker").forEach(function(e){Formwork.ImagePicker(e)}),$$(".editor-textarea").forEach(function(e){Formwork.Editor(e)}),$$("input[type=file]").forEach(function(e){Formwork.FileInput(e)}),$$("input[data-field=tags]").forEach(function(e){Formwork.TagInput(e)}),$$("input[type=range]").forEach(function(e){Formwork.RangeInput(e)}),$$(".array-input").forEach(function(e){Formwork.ArrayInput(e)})}},Formwork.ImagePicker=function(e){var t,n,a,o=$$("option",e),i=$(".image-picker-confirm",e.parentNode),r=$("[data-command=upload]",e.parentNode);if(e.style.display="none",0<o.length){for((t=document.createElement("div")).className="image-picker-thumbnails",a=0;a<o.length;a++)(n=document.createElement("div")).className="image-picker-thumbnail",n.style.backgroundImage="url("+o[a].value+")",n.setAttribute("data-uri",o[a].value),n.setAttribute("data-filename",o[a].text),n.addEventListener("click",s),n.addEventListener("dblclick",d),t.appendChild(n);e.parentNode.insertBefore(t,e),$(".image-picker-empty-state").style.display="none"}function s(){var e=document.getElementById($(".image-picker-confirm").getAttribute("data-target"));e&&(e.value=this.getAttribute("data-filename")),$$(".image-picker-thumbnail").forEach(function(e){e.classList.remove("selected")}),this.classList.add("selected")}function d(){this.click(),$(".image-picker-confirm").click()}i.addEventListener("click",function(){var e=$(".image-picker-thumbnail.selected"),t=document.getElementById(this.getAttribute("data-target"));e&&t&&(t.value=e.getAttribute("data-filename"))}),r.addEventListener("click",function(){document.getElementById(this.getAttribute("data-upload-target")).click()})},Formwork.Modals={init:function(){$$("[data-modal]").forEach(function(e){e.addEventListener("click",function(){var e=this.getAttribute("data-modal"),t=this.getAttribute("data-modal-action");t?Formwork.Modals.show(e,t):Formwork.Modals.show(e)})}),$$(".modal [data-dismiss]").forEach(function(e){e.addEventListener("click",function(){this.hasAttribute("data-validate")&&!Formwork.Modals.validate(this.getAttribute("data-dismiss"))||Formwork.Modals.hide(this.getAttribute("data-dismiss"))})}),$$(".modal").forEach(function(e){e.addEventListener("click",function(e){e.target===this&&Formwork.Modals.hide()})}),document.addEventListener("keyup",function(e){27===e.which&&Formwork.Modals.hide()})},show:function(e,t,n){var a=document.getElementById(e);a&&(a.classList.add("show"),t&&$("form",a).setAttribute("action",t),$("[autofocus]",a)&&Formwork.Utils.triggerEvent($("[autofocus]",a),"focus"),"function"==typeof n&&n(a),$$(".tooltip").forEach(function(e){e.parentNode.removeChild(e)}),this.createBackdrop())},hide:function(e){void 0!==e?document.getElementById(e).classList.remove("show"):$$(".modal").forEach(function(e){e.classList.remove("show")}),this.removeBackdrop()},createBackdrop:function(){var e;$(".modal-backdrop")||((e=document.createElement("div")).className="modal-backdrop",document.body.appendChild(e))},removeBackdrop:function(){var e=$(".modal-backdrop");e&&e.parentNode.removeChild(e)},validate:function(e){var t=!1,n=document.getElementById(e);return $$("[required]",e).forEach(function(e){if(""===e.value)return e.classList("input-invalid"),Formwork.Utils.triggerEvent(e,"focus"),$(".modal-error",n).style.display="block",t=!1;t=!0}),t}},Formwork.Notification=function(e,t,n,a){var o,i,r=$(".notification-container");function s(){o.classList.add("fadeout"),setTimeout(function(){o.parentNode&&r.removeChild(o),r.childNodes.length<1&&(r.parentNode&&document.body.removeChild(r),r=null)},a.fadeOutDelay)}return a=Formwork.Utils.extendObject({},{newestOnTop:!0,fadeOutDelay:300,mouseleaveDelay:1e3},a),{show:function(){r||((r=document.createElement("div")).className="notification-container",document.body.appendChild(r)),(o=document.createElement("div")).className="notification notification-"+t,o.innerHTML=e,a.newestOnTop&&0<r.childNodes.length?r.insertBefore(o,r.childNodes[0]):r.appendChild(o),i=setTimeout(s,n),o.addEventListener("click",s),o.addEventListener("mouseenter",function(){clearTimeout(i)}),o.addEventListener("mouseleave",function(){i=setTimeout(s,a.mouseleaveDelay)})},remove:s}},Formwork.Pages={init:function(){var e=$("[data-command=expand-all-pages]"),t=$("[data-command=collapse-all-pages]"),n=$("[data-command=reorder-pages]"),a=$(".page-search"),o=document.getElementById("newPageModal"),i=document.getElementById("slugModal");function r(){this.value=Formwork.Utils.validateSlug(this.value)}$$(".pages-list").forEach(function(e){var n,a,o;"true"===e.getAttribute("data-sortable-children")&&(n=e,a=[],a=(o=Sortable.create(n,{handle:".sort-handle",filter:"[data-sortable=false]",forceFallback:!0,onClone:function(e){e.item.closest(".pages-list").classList.add("dragging"),$$(".pages-children",e.item).forEach(function(e){e.style.display="none"}),$$(".page-children-toggle").forEach(function(e){e.classList.remove("toggle-expanded"),e.classList.add("toggle-collapsed"),e.style.opacity="0.5"})},onMove:function(e){if("false"===e.related.getAttribute("data-sortable"))return!1;$$(".pages-children",e.related).forEach(function(e){e.style.display="none"})},onEnd:function(e){var t;e.item.closest(".pages-list").classList.remove("dragging"),$$(".page-children-toggle").forEach(function(e){e.style.opacity=""}),e.newIndex!==e.oldIndex&&(o.option("disabled",!0),t={"csrf-token":$("meta[name=csrf-token]").getAttribute("content"),parent:n.getAttribute("data-parent"),from:e.oldIndex,to:e.newIndex},Formwork.Request({method:"POST",url:Formwork.baseUri+"pages/reorder/",data:t},function(e){e.status&&new Formwork.Notification(e.message,e.status,5e3).show(),e.status&&"error"!==e.status||o.sort(a),o.option("disabled",!1),a=o.toArray()}))}})).toArray())}),$$(".page-details").forEach(function(e){var t=$(".page-children-toggle",e);t&&e.addEventListener("click",function(){t.click()})}),$$(".page-details a").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation()})}),$$(".page-children-toggle").forEach(function(e){e.addEventListener("click",function(e){var t;t=this,$$(".pages-list",t.closest("li")).forEach(function(e){Formwork.Utils.toggleElement(e)}),t.classList.toggle("toggle-expanded"),t.classList.toggle("toggle-collapsed"),e.stopPropagation()})}),e&&e.addEventListener("click",function(){$$(".pages-children").forEach(function(e){e.style.display="block"}),$$(".pages-list .page-children-toggle").forEach(function(e){e.classList.remove("toggle-collapsed"),e.classList.add("toggle-expanded")}),this.blur()}),t&&t.addEventListener("click",function(){$$(".pages-children").forEach(function(e){e.style.display="none"}),$$(".pages-list .page-children-toggle").forEach(function(e){e.classList.remove("toggle-expanded"),e.classList.add("toggle-collapsed")}),this.blur()}),n&&n.addEventListener("click",function(){this.classList.toggle("active"),$$(".pages-list .sort-handle").forEach(function(e){Formwork.Utils.toggleElement(e,"inline")}),this.blur()}),a&&(a.addEventListener("focus",function(){$$(".pages-children").forEach(function(e){e.setAttribute("data-display",getComputedStyle(e).display)})}),a.addEventListener("keyup",Formwork.Utils.debounce(function(){var a;0===this.value.length?($$(".pages-children").forEach(function(e){e.style.display=e.getAttribute("data-display")}),$$(".page-details").forEach(function(e){e.style.paddingLeft=""}),$$(".pages-item, .page-children-toggle").forEach(function(e){e.style.display=""})):(a=new RegExp(Formwork.Utils.escapeRegExp(this.value),"i"),$$(".pages-children").forEach(function(e){e.style.display="block"}),$$(".page-children-toggle").forEach(function(e){e.style.display="none"}),$$(".page-details").forEach(function(e){e.style.paddingLeft="0"}),$$(".page-title a").forEach(function(e){var t=e.closest(".pages-item"),n=!!e.textContent.match(a);t.style.display=n?"block":"none"}))},100)),document.addEventListener("keydown",function(e){(e.ctrlKey||e.metaKey)&&70===e.which&&document.activeElement!==a&&(a.focus(),e.preventDefault())})),o&&($("#page-title",o).addEventListener("keyup",function(){$("#page-slug",o).value=Formwork.Utils.slug(this.value)}),$("#page-slug",o).addEventListener("keyup",r),$("#page-slug",o).addEventListener("blur",r),$("#page-parent",o).addEventListener("change",function(){var e=this.options[this.selectedIndex],t=$("#page-template",o),n=e.getAttribute("data-allowed-templates"),a=0;if(null!==n)for(n=n.split(", "),t.setAttribute("data-previous-value",t.value),t.value=n[0],a=0;a<t.options.length;a++)-1===n.indexOf(t.options[a].value)&&t.options[a].setAttribute("disabled","");else for(t.value=t.getAttribute("data-previous-value"),t.removeAttribute("data-previous-value"),a=0;a<t.options.length;a++)t.options[a].disabled=!1})),i&&($("[data-command=change-slug]").addEventListener("click",function(){Formwork.Modals.show("slugModal",null,function(e){var t=document.getElementById("slug").value,n=$("#page-slug",e);n.value=t,n.setAttribute("placeholder",t),n.focus()})}),$("#page-slug",i).addEventListener("keydown",function(e){13===e.which&&$("[data-command=continue]",i).click()}),$("#page-slug",i).addEventListener("keyup",r),$("#page-slug",i).addEventListener("blur",r),$("[data-command=generate-slug]",i).addEventListener("click",function(){var e=Formwork.Utils.slug(document.getElementById("title").value);$("#page-slug",i).value=e,$("#page-slug",i).focus()}),$("[data-command=continue]",i).addEventListener("click",function(){var e,t=$("#page-slug",i).value.replace(/^-+|-+$/,"");0<t.length&&(e=$(".page-route span").innerHTML,$$("#page-slug, #slug").forEach(function(e){e.value=t}),$("#page-slug",i).value=t,document.getElementById("slug").value=t,$(".page-route span").innerHTML=e.replace(/\/[a-z0-9-]+\/$/,"/"+t+"/")),Formwork.Modals.hide("slugModal")}))}},Formwork.RangeInput=function(e){function t(){$(".range-input-value",this.parentNode).innerHTML=this.value}e.addEventListener("change",t),e.addEventListener("input",t)},Formwork.Request=function(e,t){var n,a,o,i=new XMLHttpRequest;return i.open(e.method,e.url,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(Formwork.Utils.serializeObject(e.data)),"function"==typeof t&&(n=function(){a=JSON.parse(this.response),o=a.code||this.status,400===parseInt(o)?location.reload():t(a,i)},i.onload=n,i.onerror=n),i},Formwork.TagInput=function(a){var o,i,n,r,u,s={addKeyCodes:[32]},d=[];function l(){n.value=d.join(", "),c()}function c(){0<r.length&&(0===d.length?(i.placeholder=r,i.size=r.length):(i.placeholder="",i.size=1))}function m(t){var n=document.createElement("span"),e=document.createElement("i");n.className="tag",n.innerHTML=t,n.style.marginRight=".25rem",i.parentNode.insertBefore(n,i),e.className="tag-remove",e.addEventListener("mousedown",function(e){p(t),n.parentNode.removeChild(n),e.preventDefault()}),n.appendChild(e)}function f(e){var t;t=e,-1!==d.indexOf(t)||null!==u&&null===$('[data-value="'+t+'"]',u)?c():(d.push(e),m(e),l()),i.value="",null!==u&&h()}function p(e){var t=d.indexOf(e);-1<t&&(d.splice(t,1),l()),null!==u&&h()}function h(){var t=0;$$(".dropdown-item",u).forEach(function(e){"none"!==getComputedStyle(e).display&&t++,-1===d.indexOf(e.getAttribute("data-value"))?e.style.display="block":e.style.display="none",e.classList.remove("selected")}),u.style.display=0<t?"block":"none"}function v(){var e=$(".dropdown-item.selected",u);"none"!==getComputedStyle(e).display&&(i.value=e.getAttribute("data-value"))}function g(e){var t,n,a,o,i,r,s,d,l,c=$(".dropdown-item.selected",u);c&&c.classList.remove("selected"),e&&(e.classList.add("selected"),t=e,n=u.scrollTop,a=u.clientHeight,o=n+a,i=getComputedStyle(u),r=parseInt(i.paddingTop),s=parseInt(i.paddingBottom),d=t.offsetTop,l=d+t.clientHeight,d<n?u.scrollTop=d-r:o<l&&(u.scrollTop=l-a+s))}function y(){var e,t=$$(".dropdown-item",u);for(e=0;e<t.length;e++)if("none"!==getComputedStyle(t[e]).display)return void g(t[e])}!function(){var e=a.hasAttribute("required"),t=a.hasAttribute("disabled");(o=document.createElement("div")).className="tag-input",(i=document.createElement("input")).className="tag-inner-input",i.id=a.id,i.type="text",i.placeholder=a.placeholder,i.setAttribute("size",""),(n=document.createElement("input")).className="tag-hidden-input",n.name=a.name,n.id=a.id,n.type="text",n.value=a.value,n.readOnly=!0,n.hidden=!0,e&&(n.required=!0);t&&(o.disabled=!0,i.disabled=!0,n.disabled=!0);a.parentNode.replaceChild(o,a),o.appendChild(i),o.appendChild(n),n.value&&(d=n.value.split(", ")).forEach(function(e,t){e=e.trim(),m(d[t]=e)});i.placeholder?(r=i.placeholder,c()):r="";o.addEventListener("mousedown",function(e){i.focus(),e.preventDefault()})}(),function(){var e,t,n;if(a.hasAttribute("data-options")){for(t in e=JSON.parse(a.getAttribute("data-options")),(u=document.createElement("div")).className="dropdown-list",e)(n=document.createElement("div")).className="dropdown-item",n.innerHTML=e[t],n.setAttribute("data-value",t),n.addEventListener("click",function(){f(this.getAttribute("data-value"))}),u.appendChild(n);o.appendChild(u),i.addEventListener("focus",function(){"none"===getComputedStyle(u).display&&(h(),u.scrollTop=0,u.style.display="block")}),i.addEventListener("blur",function(){"none"!==getComputedStyle(u).display&&(h(),u.style.display="none")}),i.addEventListener("keydown",function(e){switch(e.which){case 8:h();break;case 13:"none"!==getComputedStyle(u).display&&(v(),e.preventDefault());break;case 38:"none"!==getComputedStyle(u).display&&(function(){var e,t=$(".dropdown-item.selected",u);if(t){for(e=t.previousSibling;e&&"none"===e.style.display;)e=e.previousSibling;if(e)return g(e);g(t.previousSibling)}!function(){var e,t=$$(".dropdown-item",u);for(e=t.length-1;0<=e;e--)if("none"!==getComputedStyle(t[e]).display)return g(t[e])}()}(),e.preventDefault());break;case 40:"none"!==getComputedStyle(u).display&&(function(){var e,t=$(".dropdown-item.selected",u);if(t){for(e=t.nextSibling;e&&"none"===e.style.display;)e=e.nextSibling;if(e)return g(e)}y()}(),e.preventDefault());break;default:-1<s.addKeyCodes.indexOf(e.which)&&(v(),e.preventDefault())}}),i.addEventListener("keyup",Formwork.Utils.debounce(function(e){var a,o,t=i.value.trim();switch(e.which){case 27:u.style.display="none";break;case 38:case 40:return!0;default:u.style.display="block",a=t,o=0,u.style.display="block",$$(".dropdown-item",u).forEach(function(e){var t=e.textContent,n=new RegExp(Formwork.Utils.escapeRegExp(a),"i");!!t.match(n)&&"none"!==e.style.display?(e.style.display="block",o++):e.style.display="none"}),u.style.display=0<o?"block":"none",0<t.length&&y()}},100))}}(),i.addEventListener("focus",function(){o.classList.add("focused")}),i.addEventListener("blur",function(){var e=i.value.trim();""!==e&&f(e),o.classList.remove("focused")}),i.addEventListener("keydown",function(){var e=i.value.trim();switch(event.which){case 8:""===e?(p(d[d.length-1]),i.previousSibling&&i.parentNode.removeChild(i.previousSibling),event.preventDefault()):i.size=Math.max(i.value.length,i.placeholder.length,1);break;case 13:case 188:""!==e&&f(e),event.preventDefault();break;case 27:i.value="",c(),i.blur(),event.preventDefault();break;default:if(""!==e&&-1<s.addKeyCodes.indexOf(event.which)){f(e),event.preventDefault();break}0<e.length&&(i.size=i.value.length+2)}})},Formwork.Tooltip=function(t,r){var n,e,a={container:document.body,referenceElement:document.body,position:"top",offset:{x:0,y:0},delay:500},s=r.referenceElement;function o(){clearTimeout(e),void 0!==n&&r.container.contains(n)&&r.container.removeChild(n)}return r=Formwork.Utils.extendObject({},a,r),s instanceof HTMLElement&&("button"!==s.tagName.toLowerCase()&&!s.classList.contains("button")||s.addEventListener("click",o)),s.addEventListener("mouseout",o),{show:function(){e=setTimeout(function(){var e;(n=document.createElement("div")).className="tooltip",n.setAttribute("role","tooltip"),n.style.display="block",n.innerHTML=t,r.container.appendChild(n),e=function(e){var t=s.getBoundingClientRect(),n=t.top+window.pageYOffset,a=t.left+window.pageXOffset,o=(t.width-e.offsetWidth)/2,i=(t.height-e.offsetHeight)/2;switch(r.position){case"top":return{top:Math.round(n-e.offsetHeight+r.offset.y),left:Math.round(a+o+r.offset.x)};case"right":return{top:Math.round(n+i+r.offset.y),left:Math.round(a+s.offsetWidth+r.offset.x)};case"bottom":return{top:Math.round(n+s.offsetHeight+r.offset.y),left:Math.round(a+o+r.offset.x)};case"left":return{top:Math.round(n+i+r.offset.y),left:Math.round(a-e.offsetWidth+r.offset.x)}}}(n),n.style.top=e.top+"px",n.style.left=e.left+"px"},r.delay)},remove:o}},Formwork.Tooltips={init:function(){$$("[title]").forEach(function(e){e.setAttribute("data-tooltip",e.getAttribute("title")),e.removeAttribute("title")}),$$("[data-tooltip]").forEach(function(e){e.addEventListener("mouseover",function(){new Formwork.Tooltip(this.getAttribute("data-tooltip"),{referenceElement:this,position:"bottom",offset:{x:0,y:4}}).show()})}),$$('[data-overflow-tooltip="true"]').forEach(function(e){e.addEventListener("mouseover",function(){this.offsetWidth<this.scrollWidth&&new Formwork.Tooltip(this.textContent.trim(),{referenceElement:this,position:"bottom",offset:{x:0,y:4}}).show()})})}},Formwork.Updates={init:function(){var n,a,o,t,i,r;document.getElementById("updater-component")&&(n=$(".update-status"),a=$(".spinner"),o=$(".current-version"),t=$(".current-version-name"),i=$(".new-version"),r=$(".new-version-name"),setTimeout(function(){var e={"csrf-token":$("meta[name=csrf-token]").getAttribute("content")};Formwork.Request({method:"POST",url:Formwork.baseUri+"updates/check/",data:e},function(e){var t;n.innerHTML=e.message,"success"===e.status?!1===e.data.uptodate?(t=e.data.release.name,a.classList.add("spinner-info"),r.innerHTML=t,i.style.display="block"):(a.classList.add("spinner-success"),o.style.display="block"):a.classList.add("spinner-error")})},1e3),$("[data-command=install-updates]").addEventListener("click",function(){i.style.display="none",a.classList.remove("spinner-info"),n.innerHTML=n.getAttribute("data-installing-text"),Formwork.Request({method:"POST",url:Formwork.baseUri+"updates/update/",data:{"csrf-token":$("meta[name=csrf-token]").getAttribute("content")}},function(e){new Formwork.Notification(e.message,e.status,5e3).show(),n.innerHTML=e.data.status,"success"===e.status?(a.classList.add("spinner-success"),t.innerHTML=r.innerHTML,o.style.display="block"):a.classList.add("spinner-error")})}))}},Formwork.Utils={escapeRegExp:function(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")},slug:function(e){var t,n={"\t":"","\r":"","!":"",'"':"","#":"",$:"","%":"","'":"-","(":"",")":"","*":"","+":"",",":"",".":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","]":"","^":"","`":"","{":"","|":"","}":"","¡":"","£":"","¤":"","¥":"","¦":"","§":"","«":"","°":"","»":"","‘":"","’":"","“":"","”":"","\n":"-"," ":"-","-":"-","–":"-","—":"-","/":"-","\\":"-",_:"-","~":"-","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"Ae","Ç":"C","Ð":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Œ":"Oe","Š":"S","Þ":"Th","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"ae","å":"a","æ":"ae","¢":"c","ç":"c","ð":"d","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"oe","ø":"o","œ":"oe","š":"s","ß":"ss","þ":"th","ù":"u","ú":"u","û":"u","ü":"ue","ý":"y","ÿ":"y","Ÿ":"y"};for(t in e=e.toLowerCase(),n)n.hasOwnProperty(t)&&(e=e.split(t).join(n[t]));return e.replace(/[^a-z0-9-]/g,"").replace(/^-+|-+$/g,"").replace(/-+/g,"-")},validateSlug:function(e){return e.toLowerCase().replace(" ","-").replace(/[^a-z0-9-]/g,"")},debounce:function(e,t,n){var a,o,i,r=null;return function(){return a=this,o=arguments,r&&clearTimeout(r),n&&!r&&(i=e.apply(a,o)),r=setTimeout(function(){n||(i=e.apply(a,o)),r=null},t),i}},throttle:function(n,a){var o,i,r,s=0,d=null;return function(){var e,t=Date.now();return 0===s&&(s=t),o=this,i=arguments,(e=s+a-t)<=0||a<e?(d&&(clearTimeout(d),d=null),s=t,r=n.apply(o,i)):d=d||setTimeout(function(){s=Date.now(),r=n.apply(o,i),d=null},e),r}},outerWidth:function(e){var t=e.offsetWidth,n=getComputedStyle(e);return t+=parseInt(n.marginLeft)+parseInt(n.marginRight)},outerHeight:function(e){var t=e.offsetHeight,n=getComputedStyle(e);return t+=parseInt(n.marginTop)+parseInt(n.marginBottom)},toggleElement:function(e,t){var n=e.style.display||getComputedStyle(e).display;void 0===t&&(t="block"),e.style.display="none"===n?t:"none"},extendObject:function(e){var t,n,a;for(e=e||{},t=1;t<arguments.length;t++)for(a in n=arguments[t])e[a]=n[a];return e},serializeObject:function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")},serializeForm:function(e){var t,n,a,o=[];for(n=0;n<e.elements.length;n++)if((t=e.elements[n]).name&&!t.disabled&&"file"!==t.type&&"reset"!==t.type&&"submit"!==t.type&&"button"!==t.type)if("select-multiple"===t.type)for(a=e.elements[n].options.length-1;0<=a;a--)t.options[a].selected&&o.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.options[a].value));else("checkbox"!==t.type&&"radio"!==t.type||t.checked)&&o.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value));return o.join("&")},triggerEvent:function(e,t){var n;try{n=new Event(t)}catch(e){(n=document.createEvent("HTMLEvents")).initEvent(t,!0,!0)}e.dispatchEvent(n)},triggerDownload:function(e,t){var n=document.createElement("form"),a=document.createElement("input");n.action=e,n.method="post",a.type="hidden",a.name="csrf-token",a.value=t,n.appendChild(a),document.body.appendChild(n),n.submit(),document.body.removeChild(n)},longClick:function(e,n,a,o){var i;function r(){clearTimeout(i)}e.addEventListener("mousedown",function(e){var t=this;1!==e.which?r():(n.call(t,e),i=setTimeout(function(){i=setInterval(n.bind(t,e),o)},a))}),e.addEventListener("mouseout",r),window.addEventListener("mouseup",r)}};